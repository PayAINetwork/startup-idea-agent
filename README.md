## Startup Idea Agent

Sell high‑quality, research‑backed startup idea each day for $1. The agent purchases curated business news, analyzes changes that create opportunities, and then sells the single best idea with TAM, why‑now, concrete first steps, and a link to the source article.

### Features
- **Paid route (`/idea-of-the-day`)**: protected by `x402-next` middleware; costs $1 per request
- **Curated news purchase**: uses `x402-axios` to pay and fetch from `https://biznews.x402.bot/news`
- **AI analysis**: uses OpenAI to synthesize the opportunity, TAM, why now, and how to get started
- **Simple landing page**: clear CTA to purchase today’s idea

---

## Quickstart

1) Install dependencies
```bash
npm i
```

2) Create `.env.local`
```bash
cp .env.example .env
```
Fill in your keys (see Environment Variables below).

3) Run the dev server
```bash
npm run dev
```
Open http://localhost:3000 and click “Get today’s idea — $1”.

---

## Environment Variables
Create `.env` with:
```
# OpenAI (required)
OPENAI_API_KEY=sk-...

# 402 payments (required)
PRIVATE_KEY=...             # Solana devnet private key for payments
RESOURCE_WALLET_ADDRESS=... # Wallet to receive payments
NEXT_PUBLIC_FACILITATOR_URL=https://facilitator.payai.network
```

Notes:
- The middleware in `src/middleware.ts` is configured for `solana-devnet` and protects `/idea-of-the-day` at a price of $1.
- The route `src/app/idea-of-the-day/route.ts` uses the same network for the signer.

---

## How payments work
- `src/middleware.ts` uses `paymentMiddleware` from `x402-next` to enforce a price for `/idea-of-the-day`.
- The API route creates a signer via `createSigner("solana-devnet", process.env.PRIVATE_KEY)` and wraps Axios with `withPaymentInterceptor` to pay the upstream news provider when requesting `/news`.

---

## API
### GET `/idea-of-the-day`
Returns a single structured startup idea in JSON. Example shape:
```json
{
  "opportunity": "…",
  "tam": { "estimate": "…", "methodology": "…" },
  "whyNow": "…",
  "gettingStarted": ["…", "…", "…"],
  "source": { "title": "…", "url": "…" }
}
```

Response is generated by purchasing curated headlines and analyzing them with OpenAI.

### Usage examples (x402-axios)
Programmatically pay and fetch today’s idea using `x402-axios`.

```ts
// scripts/fetch-idea.ts
import axios from "axios";
import { config } from "dotenv";
import {
  withPaymentInterceptor,
  createSigner,
  decodeXPaymentResponse,
  type Hex,
} from "x402-axios";

config();

async function main(): Promise<void> {
  const baseURL = process.env.IDEA_AGENT_URL ?? "http://localhost:3000";
  const privateKey = process.env.PRIVATE_KEY as Hex | string | undefined;
  if (!privateKey) throw new Error("Missing PRIVATE_KEY env var");

  // Create a signer for Solana devnet and wrap axios with the 402 payment interceptor
  const signer = await createSigner("solana-devnet", privateKey);
  const api = withPaymentInterceptor(
    axios.create({ baseURL }),
    signer,
  );

  // This will trigger a 402 flow if payment is required by the server
  const response = await api.get("/idea-of-the-day");
  console.log("Idea of the day:\n", JSON.stringify(response.data, null, 2));

  // Optional: inspect the payment receipt returned by the server
  const payment = decodeXPaymentResponse(response.headers["x-payment-response"]);
  console.log("Payment receipt:\n", payment);
}

main().catch((err) => {
  console.error(err);
  process.exit(1);
});
```

Run it:
```bash
IDEA_AGENT_URL=http://localhost:3000 \
PRIVATE_KEY=your_solana_devnet_private_key \
node --loader ts-node/esm scripts/fetch-idea.ts
```

Notes:
- Use your deployment URL for `IDEA_AGENT_URL` in production.
- The middleware protects `/idea-of-the-day` and will require payment automatically.
- The interceptor attaches the proof of payment, so the server returns the idea JSON.

---

## Project structure
- `src/app/page.tsx` — Landing page with CTA
- `src/app/idea-of-the-day/route.ts` — Paid route that purchases news and returns analyzed idea JSON
- `src/middleware.ts` — 402 payment middleware configuration

---

## Deploy
Any Next.js hosting works. Make sure to set the environment variables in your hosting provider. For Vercel, add the keys to Project Settings → Environment Variables and redeploy.

---

## Troubleshooting
- 402 payment prompts not shown: verify `NEXT_PUBLIC_FACILITATOR_URL` and `RESOURCE_WALLET_ADDRESS`.
- Upstream news fetch failing: ensure `PRIVATE_KEY` is a valid Solana devnet key and the network matches.
- OpenAI errors: double‑check `OPENAI_API_KEY` and model availability.
